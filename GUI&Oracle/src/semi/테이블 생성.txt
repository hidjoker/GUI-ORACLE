-- class 테이블



CREATE TABLE CLASS
(
    CLASSNAME    VARCHAR2(100)    NOT NULL, 
    STARTDATE    DATE             NOT NULL, 
    ENDDATE      DATE             NOT NULL, 
    SUBJECT      VARCHAR2(200)    NOT NULL, 
    STUNO        NUMBER           NOT NULL, 
    TOTAL        NUMBER           NOT NULL, 
    CONSTRAINT CLASS_PK PRIMARY KEY (CLASSNAME)
)
/

COMMENT ON COLUMN CLASS.CLASSNAME IS ''B_PM(AM)'의 형태'
/

COMMENT ON COLUMN CLASS.STARTDATE IS '개강일'
/

COMMENT ON COLUMN CLASS.ENDDATE IS '종강일'
/

COMMENT ON COLUMN CLASS.SUBJECT IS '강의명'
/

COMMENT ON COLUMN CLASS.STUNO IS '학생 수'
/

COMMENT ON COLUMN CLASS.TOTAL IS '총 강의일'
/




-- user 테이블

CREATE TABLE USERDATA
(
    ID         VARCHAR2(100)    NOT NULL, 
    PW         VARCHAR2(200)    NOT NULL, 
    NAME       VARCHAR2(100)    NOT NULL, 
    CLASS      VARCHAR2(100)    NOT NULL, 
    PHONE      NUMBER           NOT NULL, 
    BIRTH      NUMBER           NOT NULL, 
    EMAIL      VARCHAR2(200)    NOT NULL, 
    GENDER     VARCHAR2(20)     NOT NULL, 
    SUBDATE    DATE             NOT NULL, 
    CONSTRAINT USERDATA_PK PRIMARY KEY (ID)
)
/

COMMENT ON TABLE USERDATA IS '유저정보 테이블'
/

COMMENT ON COLUMN USERDATA.ID IS '아이디'
/

COMMENT ON COLUMN USERDATA.PW IS 'default(000000)'
/

COMMENT ON COLUMN USERDATA.NAME IS '이름'
/

COMMENT ON COLUMN USERDATA.CLASS IS '강의실'
/

COMMENT ON COLUMN USERDATA.PHONE IS '연락처'
/

COMMENT ON COLUMN USERDATA.BIRTH IS '생년월일'
/

COMMENT ON COLUMN USERDATA.EMAIL IS '이메일'
/

COMMENT ON COLUMN USERDATA.GENDER IS '성별'
/

COMMENT ON COLUMN USERDATA.SUBDATE IS 'default(sysdate)'
/

ALTER TABLE USERDATA
    ADD CONSTRAINT FK_USERDATA_CLASS_CLASS_CLASSN FOREIGN KEY (CLASS)
        REFERENCES CLASS (CLASSNAME)
/


-- board 테이블

CREATE TABLE BOARD
(
    BOARDNO      NUMBER            NOT NULL, 
    WRITERID     VARCHAR2(100)     NOT NULL, 
    WRITER       VARCHAR2(100)     NOT NULL, 
    TITLE        VARCHAR2(300)     NOT NULL, 
    CONTENT      VARCHAR2(4000)    NOT NULL, 
    HIT          NUMBER            NOT NULL, 
    BOARDTYPE    VARCHAR2(100)     NOT NULL, 
    ENABLE       NUMBER            NOT NULL, 
    INDATE       DATE              NOT NULL, 
    MSGTO        NUMBER            NOT NULL, 
    CONSTRAINT BOARD_PK PRIMARY KEY (BOARDNO)
)
/

CREATE SEQUENCE BOARD_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER BOARD_BOARDNO_AI_TRG
BEFORE INSERT ON BOARD 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT BOARD_SEQ.NEXTVAL
    INTO: NEW.BOARDNO
    FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER BOARD_HIT_AI_TRG
BEFORE INSERT ON BOARD 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT BOARD_SEQ.NEXTVAL
    INTO: NEW.HIT
    FROM DUAL;
END;
/

COMMENT ON COLUMN BOARD.BOARDNO IS '게시글번호'
/

COMMENT ON COLUMN BOARD.WRITERID IS '작성자ID'
/

COMMENT ON COLUMN BOARD.WRITER IS '작성자 이름'
/

COMMENT ON COLUMN BOARD.TITLE IS '제목'
/

COMMENT ON COLUMN BOARD.CONTENT IS '본문'
/

COMMENT ON COLUMN BOARD.HIT IS 'Default('0')'
/

COMMENT ON COLUMN BOARD.BOARDTYPE IS '게시판이름'
/

COMMENT ON COLUMN BOARD.ENABLE IS 'Boolean/Default(1)'
/

COMMENT ON COLUMN BOARD.INDATE IS 'Default(sysdate)'
/

COMMENT ON COLUMN BOARD.MSGTO IS 'Boolean'
/

ALTER TABLE BOARD
    ADD CONSTRAINT FK_BOARD_WRITERID_USERDATA_ID FOREIGN KEY (WRITERID)
        REFERENCES USERDATA (ID)
/


-- board_comment 테이블


CREATE TABLE COMMENTS
(
    COMMENTNO    NUMBER            NOT NULL, 
    BOARDNO      NUMBER            NOT NULL, 
    WRITERID     VARCHAR2(100)     NOT NULL, 
    WRITER       VARCHAR2(100)     NOT NULL, 
    INDATE       DATE              NOT NULL, 
    CONTENT      VARCHAR2(1000)    NOT NULL, 
    CONSTRAINT COMMENTS_PK PRIMARY KEY (COMMENTNO)
)
/

CREATE SEQUENCE COMMENTS_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER COMMENTS_COMMENTNO_AI_TRG
BEFORE INSERT ON COMMENTS 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT COMMENTS_SEQ.NEXTVAL
    INTO: NEW.COMMENTNO
    FROM DUAL;
END;
/

COMMENT ON COLUMN COMMENTS.COMMENTNO IS '댓글 번호'
/

COMMENT ON COLUMN COMMENTS.BOARDNO IS '게시글번호'
/

COMMENT ON COLUMN COMMENTS.WRITERID IS '작성자 ID'
/

COMMENT ON COLUMN COMMENTS.WRITER IS '작성자 이름'
/

COMMENT ON COLUMN COMMENTS.INDATE IS 'Default(sysdate)'
/

COMMENT ON COLUMN COMMENTS.CONTENT IS '본문'
/

ALTER TABLE COMMENTS
    ADD CONSTRAINT FK_COMMENTS_BOARDNO_BOARD_BOAR FOREIGN KEY (BOARDNO)
        REFERENCES BOARD (BOARDNO)
/

ALTER TABLE COMMENTS
    ADD CONSTRAINT FK_COMMENTS_WRITERID_USERDATA_ FOREIGN KEY (WRITERID)
        REFERENCES USERDATA (ID)
/



-- board_recommend 테이블



CREATE TABLE BOARD_RECOMMEND
(
    BOARDNO    NUMBER           NOT NULL, 
    ID         VARCHAR2(100)    NOT NULL
)
/

COMMENT ON COLUMN BOARD_RECOMMEND.BOARDNO IS '게시글번호'
/

COMMENT ON COLUMN BOARD_RECOMMEND.ID IS '아이디'
/

ALTER TABLE BOARD_RECOMMEND
    ADD CONSTRAINT FK_BOARD_RECOMMEND_ID_USERDATA FOREIGN KEY (ID)
        REFERENCES USERDATA (ID)
/

ALTER TABLE BOARD_RECOMMEND
    ADD CONSTRAINT FK_BOARD_RECOMMEND_BOARDNO_BOA FOREIGN KEY (BOARDNO)
        REFERENCES BOARD (BOARDNO)
/



-- file_upload 테이블


CREATE TABLE UPLOAD
(
    FILENO        NUMBER           NOT NULL, 
    BOARDNO       NUMBER           NOT NULL, 
    BEFORE        VARCHAR2(500)    NOT NULL, 
    AFTER         VARCHAR2(500)    NOT NULL, 
    FILESIZE      NUMBER           NOT NULL, 
    UPLOADDATE    DATE             NOT NULL, 
    CONSTRAINT UPLOAD_PK PRIMARY KEY (FILENO)
)
/

CREATE SEQUENCE UPLOAD_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER UPLOAD_FILENO_AI_TRG
BEFORE INSERT ON UPLOAD 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT UPLOAD_SEQ.NEXTVAL
    INTO: NEW.FILENO
    FROM DUAL;
END;
/

COMMENT ON COLUMN UPLOAD.FILENO IS '파일 번호'
/

COMMENT ON COLUMN UPLOAD.BOARDNO IS '게시글 번호'
/

COMMENT ON COLUMN UPLOAD.BEFORE IS '원본 파일명'
/

COMMENT ON COLUMN UPLOAD.AFTER IS '저장 파일명'
/

COMMENT ON COLUMN UPLOAD.FILESIZE IS '파일 크기'
/

COMMENT ON COLUMN UPLOAD.UPLOADDATE IS 'Default(sysdate)'
/

ALTER TABLE UPLOAD
    ADD CONSTRAINT FK_UPLOAD_BOARDNO_BOARD_BOARDN FOREIGN KEY (BOARDNO)
        REFERENCES BOARD (BOARDNO)
/


-- comment_recommend 테이블


CREATE TABLE COMMENTS_RECOMMEND
(
    COMMENTNO    NUMBER           NOT NULL, 
    ID           VARCHAR2(100)    NOT NULL, 
    BOARDNO      NUMBER           NOT NULL
)
/

COMMENT ON COLUMN COMMENTS_RECOMMEND.COMMENTNO IS '댓글 번호'
/

COMMENT ON COLUMN COMMENTS_RECOMMEND.ID IS '아이디'
/

COMMENT ON COLUMN COMMENTS_RECOMMEND.BOARDNO IS '게시글 번호'
/

ALTER TABLE COMMENTS_RECOMMEND
    ADD CONSTRAINT FK_COMMENTS_RECOMMEND_ID_USERD FOREIGN KEY (ID)
        REFERENCES USERDATA (ID)
/

ALTER TABLE COMMENTS_RECOMMEND
    ADD CONSTRAINT FK_COMMENTS_RECOMMEND_BOARDNO_ FOREIGN KEY (BOARDNO)
        REFERENCES BOARD (BOARDNO)
/

ALTER TABLE COMMENTS_RECOMMEND
    ADD CONSTRAINT FK_COMMENTS_RECOMMEND_COMMENTN FOREIGN KEY (COMMENTNO)
        REFERENCES COMMENTS (COMMENTNO)
/


-- chat 테이블



CREATE TABLE CHAT
(
    CHATNo    NUMBER            NOT NULL, 
    NAME      VARCHAR2(100)     NOT NULL, 
    MSG       VARCHAR2(3000)    NOT NULL, 
    INDATE    VARCHAR2(500)     NOT NULL, 
    CONSTRAINT CHAT_PK PRIMARY KEY (CHATNo)
)
/

CREATE SEQUENCE CHAT_SEQ
START WITH 1
INCREMENT BY 1;
/

CREATE OR REPLACE TRIGGER CHAT_CHATNo_AI_TRG
BEFORE INSERT ON CHAT 
REFERENCING NEW AS NEW FOR EACH ROW 
BEGIN 
    SELECT CHAT_SEQ.NEXTVAL
    INTO: NEW.CHATNo
    FROM DUAL;
END;
/

COMMENT ON COLUMN CHAT.CHATNo IS '채팅번호'
/

COMMENT ON COLUMN CHAT.NAME IS 'SESSION 사용'
/

COMMENT ON COLUMN CHAT.MSG IS '메시지'
/

COMMENT ON COLUMN CHAT.INDATE IS '입력시간'

